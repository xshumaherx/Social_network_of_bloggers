{% extends 'base.html'%}
{% block title %}
  Последние обновления на сайте
{% endblock %}
{% load thumbnail %}
{% block content %}
  <div class="container py-5">
    <h1>Последние обновления на сайте</h1>
    <form action="" method="get">
      <input type="text" name="q" value="{{ query|default:'' }}" placeholder="Поиск..."
             title="Введите слово или предложение которое хотите найти в тексте или заголовках">
      <label for="date_of">Дата от:</label>
      <input type="date" name="date_of" id="date_of" value="{{ date_of|default:'' }}"
             title="Введите дату, от какого числа(включительно)">
      <label for="date_to">до:</label>
      <input type="date" name="date_to" id="date_to" value="{{ date_to|default:'' }}"
             title="Введите дату, до какого числа(включительно)">
      <label for="sort">Сортировать по:</label>
      <select name="sort" id="sort">
        <option value="pub_date" {% if sort == 'pub_date' %}selected{% endif %}>Дате</option>
        <option value="author" {% if sort == 'author' %}selected{% endif %}>Автору</option>
        <option value="titul" {% if sort == 'titul' %}selected{% endif %}>Заголовок</option>
      </select>
      <label for="direction">Сортировка:</label>
      <select name="direction" id="direction">
        <option value="desc" {% if direction == 'desc' %}selected{% endif %}>По убыванию</option>
        <option value="asc" {% if direction == 'asc' %}selected{% endif %}>По возрастанию</option>
      </select>
      <button type="submit" class="btn btn-primary">Применить</button>
    </form>
    <br>
    <article>
      {% include 'includes/switcher.html' %}
      <div style="display: flex; flex-direction: row;">
        <div style="height: 400px; overflow-y: auto;">
          <table>
            {% for post in page_obj %}
            <tr>
              <td>
                <ul class="list-group">
                  <li class="list-group-item telegram-list__item"
                      data-bs-target="#postId{{ post.pk }}" 
                      onclick="showText({{ post.pk }}, this)">
                      <div style="justify-content: space-between; font-size: 13px;">
                          <div style="text-align: left">{{ post.author.get_full_name }}</div>
                          <div style="text-align: right">{{ post.pub_date|date:"d E Y" }}</div>
                      </div>
                      <div style="text-align: center;">{{ post.titul }}</div>
                  </li>
                </ul>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td><h3 style="color:#fff">Публикации не найдены!</h3></td>
            </tr>
            {% endfor %}
          </table>
        </div>
        <div style="flex: 1;">
          <table>
            <tr>
              <td>
                <div>
                  {% if post_image_url %}
                    {% thumbnail post_image_url "960x339" crop="center" upscale=True as im %}
                      <img class="card-img my-2" src="{{ im.url }}">
                    {% endthumbnail %}
                  {% endif %}
                </div>
                <div id="postText"></div>
              </td>
            </tr>
          </table>
        </div>
      </div>
    </article>
  </div>
  <p style="color: #000; padding: 10px; margin: 20px; font-size: 26px;">
    Записей <strong>{{ page_obj.count }}</strong> из <strong>{{ total_posts }}</strong>
  </p>
{% endblock %}

   {% comment %} <article>
      {% include 'includes/switcher.html' %}
      <div style="display: flex; flex-direction: row;">
        <div style="height: 500px; overflow-y: auto;">
          <table>
            {% for post in page_obj %}
            <tr>
              <td>
                <ul class="list-group">
                  <li class="list-group-item telegram-list__item" data-bs-toggle="modal" data-bs-target="#myModal{{ post.pk }}">
                    <a href="{% url 'posts:post_detail' post.pk %}">
                      <div style="justify-content: space-between; font-size: 13px;">
                        <div style="text-align: left">{{ post.author.get_full_name }}</div>
                        <div style="text-align: right">{{ post.pub_date|date:"d E Y" }}</div>
                      </div>
                      <div style="text-align: center;">{{ post.titul }}</div>
                    </a>
                  </li>
                </ul>
              </td>
            </tr>
            {% endfor %}
          </table>
        </div>
        <div style="flex: 1;">
          {% for post in page_obj %}
            <table>
            <tr>
              <td>
                  {{ post.text }}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td>
                <h3 style="color:#fff">Публикации не найдены!</h3>
              </td>
            </tr>
            {% endfor %}
          </table>
        </div>
      </div>
      <p style="color: #000; padding: 10px; margin: 20px; font-size: 26px;">
        Записей <strong>{{ page_obj.count }}</strong> из <strong>{{ total_posts }}</strong>
      </p>
    </article> {% endcomment %}
{% comment %}             {% empty %}
            <tr>
              <td>
                <h3 style="color:#fff">Публикации не найдены!</h3>
              </td>
            </tr>
            {% endfor %}
          </table>
        </div>
      </div>
      <p style="color: #000; padding: 10px; margin: 20px; font-size: 26px;">
        Записей <strong>{{ page_obj.count }}</strong> из <strong>{{ total_posts }}</strong>
      </p> {% endcomment %}

      {% comment %} <table>
        {% for post in page_obj %}
        <tr>
          <td>
            <ul class="list-group">
              <li class="list-group-item telegram-list__item" data-bs-toggle="modal" data-bs-target="#myModal{{ post.pk }}">
                <a href="#myModal{{ post.pk }}" data-bs-toggle="modal" data-bs-target="#myModal{{ post.pk }}">
                  <div style="justify-content: space-between; font-size: 13px;">
                    <div style="text-align: left">{{ post.author.get_full_name }}</div>
                    <div style="text-align: right">{{ post.pub_date|date:"d E Y" }}</div>
                  </div>
                  <div style="text-align: center;">{{ post.titul }}</div>
                </a>
              </li>
            </ul>
          </td>
        </tr> {% endcomment %}

          {% comment %} <td>
            <div class="modal fade" id="myModal{{ post.pk }}" tabindex="-1" aria-labelledby="myModal{{ post.pk }}Label"
              aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h4 class="modal-title text-left" id="myModalLabel{{ post.pk }}">{{ post.titul }}</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                  </div>
                  <div class="modal-body">
                    Автор:
                    <a href="{% url 'posts:profile' post.author.username %}">
                      {{ post.author.get_full_name }}
                    </a>
                  </div>
                  <div class="modal-body">
                    Дата публикации: {{ post.pub_date|date:"d E Y" }}
                  </div>
                  <div class="modal-body">
                    {{ post.short_text }}
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Закрыть</button>
                    <a href="{% url 'posts:post_detail' post.pk %}" class="btn btn-primary">Подробнее</a>
                  </div>
                </div>
              </div>
            </div>
          </td> {% endcomment %}

          {% comment %} {% include 'includes/paginator.html' %} {% endcomment %}