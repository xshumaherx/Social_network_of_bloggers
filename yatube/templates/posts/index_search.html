{% extends 'base.html'%}
{% block title %}
  Последние обновления на сайте
{% endblock %}
{% load thumbnail %}

{% block content %}
  <div class="container py-5">
    <h1>Последние обновления на сайте</h1>
    <form action="" method="get">
      <input type="text" name="q" value="{{ query|default:'' }}" placeholder="Поиск..."
             title="Введите слово или предложение которое хотите найти в текстах">
      <label for="date_of">Дата от:</label>
      <input type="date" name="date_of" id="date_of" value="{{ date_of|default:'' }}"
             title="Введите дату, от какого числа(включительно)">
      <label for="date_to">до:</label>
      <input type="date" name="date_to" id="date_to" value="{{ date_to|default:'' }}"
             title="Введите дату, до какого числа(включительно)">
      <label for="sort">Сортировать по:</label>
      <select name="sort" id="sort">
        <option value="pub_date" {% if sort == 'pub_date' %}selected{% endif %}>Дате</option>
        <option value="author" {% if sort == 'author' %}selected{% endif %}>Автору</option>
        <option value="titul" {% if sort == 'titul' %}selected{% endif %}>Заголовок</option>
      </select>
      <label for="direction">Направление:</label>
      <select name="direction" id="direction">
        <option value="desc" {% if direction == 'desc' %}selected{% endif %}>По убыванию</option>
        <option value="asc" {% if direction == 'asc' %}selected{% endif %}>По возрастанию</option>
      </select>
      <button type="submit" class="btn btn-primary">Применить</button>
    </form>
    <br>
    <p style="color: #000;padding: 10px;
              margin: 20px;font-size: 26px;">Всего
      <strong>{{ page_obj.paginator.count }}</strong> постов</p>
    <article>
      {% include 'includes/switcher.html' %}
      <table>
        {% for post in page_obj %}
          <tr>
            <td>
              <button type="button" class="btn btn-primary btn-lg btn-block"
                      data-toggle="modal" data-target="#myModal{{ post.pk }}">
                {{ post.titul }}
              </button>
              <div class="modal fade" id="myModal{{ post.pk }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h4 class="modal-title text-left" id="myModalLabel{{ post.pk }}">{{ post.titul }}</h4>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </div>
                    <div class="modal-body">
                      Автор:
                      <a href="{% url 'posts:profile' post.author.username %}">
                        {{ post.author.get_full_name }}
                      </a>
                    </div>
                    <div class="modal-body">
                      Дата публикации: {{ post.pub_date|date:"d E Y" }}
                    </div>
                    <div class="modal-body">
                      {{ post.short_text }}
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-danger" data-dismiss="modal">Закрыть</button>
                      <a href="{% url 'posts:post_detail' post.pk %}" class="btn btn-primary">Подробнее</a>
                    </div>
                  </div>
                </div>
              </div>
            </td>
        {% empty %}
          <tr>
            <td><h3 style="color:#fff">Публикации не найдены!</h3></td>
          </tr>
        {% endfor %}
      </table>
      {% include 'includes/paginator.html' %}
    </article>
  </div>
{% endblock %}
